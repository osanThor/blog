---
title: "React Hook í†ºì•„ë³´ê¸° useState(1)"
tags:
  - React
  - Hook
description: "React Hook useStateì˜ ì½”ë“œë¥¼ ë³´ë©° reactì˜ ë™ì‘ì›ë¦¬ì— ëŒ€í•´ ì´í•´í•˜ì"
date: 2024.10.15
cover: "/posts/dev/20241015-react-useState/cover.png"
href: "20241015-react-useState"
series: "React Hook í†ºì•„ë³´ê¸°"
category: dev
---

<Heading type="h2">React Hooks í†ºì•„ë³´ê¸°</Heading>

ì˜¤í”ˆì†ŒìŠ¤ë¥¼ ë§Œë“¤ì–´ë³´ê¸° ì „ **ì˜¤í”ˆì†ŒìŠ¤ ëœ¯ì–´ë³´ê¸° í”„ë¡œì íŠ¸** ì²«ë²ˆì§¸ `React hook` ë“¤ì„ ëª¨ë‘ ê¹Œë³´ê¸°ë¡œ í•˜ì˜€ë‹¤.
ìœ íŠœë¸Œë¥¼ ë³´ë‹ˆ ì˜¤í”ˆì†ŒìŠ¤ëŠ” ì¼ë‹¨ ë”°ë¼ê°€ ë³´ëŠ”ê±°ë”ë¼ `*Let's get it*`

<Heading type="h3">useState</Heading>

`useState`ëŠ” ì»´í¬ë„ŒíŠ¸ì˜ ìƒíƒœë¥¼ ê´€ë¦¬í•´ì£¼ê³  ì—…ë°ì´íŠ¸ ë§ˆë‹¤ UIë¥¼ ë¦¬ë Œë”ë§ ì‹œì¼œì£¼ë©° ê°„ë‹¨í•˜ê°€
ìƒíƒœë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤. ê·¸ê²Œ ì§€ê¸ˆ `useState`ë¥¼ ê¹Œë³´ëŠ” ì´ìœ ë‹¤. ì•Œê³  ì‹¶ìœ¼ë‹ˆê¹Œ

<Heading type="h4">useState ì •ì˜</Heading>

<Blockquote>
  useStateëŠ” ì»´í¬ë„ŒíŠ¸ì— state ë³€ìˆ˜ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆëŠ” React Hookì…ë‹ˆë‹¤.
  <br />
  -[React](https://ko.react.dev/reference/react/useState)
</Blockquote>

ì´ëŠ” Reactì—ì„œ ì„¤ëª…í•˜ëŠ” `useState`ì˜ ì •ì˜ì´ê³ 
ì¢€ ë” ì¶”ê°€í•´ë³´ë©´ `react`ì˜ í•¨ìˆ˜í˜• ì»´í¬ë„ŒíŠ¸ì—ì„œ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ëŠ” `Hook`ìœ¼ë¡œ ì„¤ëª…í•  ìˆ˜ ìˆì„ ê²ƒ ê°™ë‹¤.

<Heading type="h4">Hookì´ë€?</Heading>

`Hook`ì´ë€ Reactê°€ **Ver.16.8.0**ìœ¼ë¡œ ì—…ë°ì´íŠ¸ ë˜ë©´ì„œ **í•¨ìˆ˜í˜• ì»´í¬ë„ŒíŠ¸**ì˜ ë“±ì¥! ê·¸ë¡œì¸í•´ ê¸°ì¡´ì˜ Classí˜• ì»´í¬ë„ŒíŠ¸ì—ì„œ ê´€ë¦¬í•˜ë˜ **ìƒëª…ì£¼ê¸° ê¸°ëŠ¥(lifecycle features)**ì„ **â€œì—°ë™(hook into)â€œ**ë¥¼ ë„ì™€ì£¼ëŠ” ë¡œì§

<Heading type="h4">í´ë˜ìŠ¤ ì»´í¬ë„ŒíŠ¸ì™€ í•¨ìˆ˜í˜• ì»´í¬ë„ŒíŠ¸ì˜ ìƒíƒœ(state)</Heading>

ì„¤ëª…í–ˆë“¯ì´ `useState`ëŠ” í•¨ìˆ˜í˜• ì»´í¬ë„ŒíŠ¸ì—ì„œ **ìƒíƒœ(state)** ê´€ë¦¬ë¥¼ ë„ì™€ì£¼ëŠ” `Hook`ì´ë‹¤.
í•¨ìˆ˜í˜• ì»´í¬ë„ŒíŠ¸ê°€ ë‚˜ì˜¤ê¸° ì „ í´ë˜ìŠ¤ ì»´í¬ë„ŒíŠ¸ëŠ” ì–´ë–»ê²Œ ìƒíƒœê´€ë¦¬ë¥¼ í–ˆì„ê¹Œ?

```jsx
// Class Component
class App extends React.Component {
  // ìƒì„±ì(constructor)
  constructor(props) {
    super(props);
    // ì´ˆê¸° ìƒíƒœ(state)
    this.state = {
      count: 0,
    };
  }

  render() {
    // state ë¶ˆëŸ¬ì˜¤ê¸°
    const { count } = this.state;
    return (
      <>
        <div>{count}</div>
        <button onClick={() => this.setState({ count: count + 1 })}>
          ì¦ê°€
        </button>
      </>
    );
  }
}
```

ì•„ë˜ëŠ” í•¨ìˆ˜í˜• component

```tsx
export default function App() {
  // useState í˜¸ì¶œ
  const [count, setCount] = useState<number>(0);

  function handleIncrease() {
    setCount(count + 1);
  }

  return (
    <>
      <div>{count}</div>
      <button onClick={() => this.setState({ count: count + 1 })}>ì¦ê°€</button>
    </>
  );
}
```

ê·¸ëƒ¥ ë³´ê¸°ì—ë„ í¸í•´ë³´ì¸ë‹¤. `useState`ì•ˆì—ì„œ `state`ì™€ `setState` ëª¨ë‘ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.

![warn](/posts/dev/20241015-react-useState/1.png)

í•˜ì§€ë§Œ ê³µì‹ë¬¸ì„œì—ì„œë„ í•¨ìˆ˜í˜• ì»´í¬ë„ŒíŠ¸ë¥¼ ê¶Œì¥í•˜ê³  ìˆìœ¼ë‹ˆ ê±±ì •í•  í•„ìš”ëŠ” ì—†ì„ ê²ƒ ê°™ë‹¤.

<Heading type="h4">ì›ë¦¬</Heading>

ì´ì œ ì½”ë“œë¥¼ íƒí—˜í•´ ë³´ë©´ì„œ ì–´ë–¤ ì›ë¦¬ë¡œ ì›€ì§ì´ëŠ”ì§€ í™•ì¸í•´ë³´ì. (...ë‘ë ¤ì›Œ)

![type](/posts/dev/20241015-react-useState/2.png)

```ts
/**
 * Returns a stateful value, and a function to update it.
 *
 * @version 16.8.0
 * @see https://react.dev/reference/react/useState
 */
function useState<S>(
  initialState: S | (() => S)
): [S, Dispatch<SetStateAction<S>>];
// convenience overload when first argument is omitted
/**
 * Returns a stateful value, and a function to update it.
 *
 * @version 16.8.0
 * @see https://react.dev/reference/react/useState
 */
function useState<S = undefined>(): [
  S | undefined,
  Dispatch<SetStateAction<S | undefined>>
];
```

ì‰?
ì•„..!
`typescript`ë¥¼ ì‚¬ìš©í•´ì„œ `import` í–ˆë”ë‹ˆ `d.ts` íŒŒì¼ë¡œ íƒ€ì…ì •ì˜ë§Œ ë˜ì–´ìˆë‹¤.

íƒ€ì…ì„¤ëª…ì„ ë³´ë©´ Ver16.8.0ë¶€í„° ìˆì—ˆê³  ìƒíƒœê°’ê³¼ ê·¸ê²ƒì„ ì—…ë°ì´íŠ¸í•˜ëŠ” í•¨ìˆ˜ë¥¼ ë°˜í™˜í•œë‹¤ê³  ì í˜€ ìˆë‹¤.
`S`ëŠ” `state`ë¼ëŠ” ëœ»ì´ë‹¤. `initialState`ì—ëŠ” `state`ë‚˜ `state`ë¥¼ ì²˜ë¦¬í•˜ëŠ” í•¨ìˆ˜ë¥¼ ì¸ìë¡œ ë°›ê³  `S(ìƒíƒœ)`ì™€ `Dispatch<SetStateAction<S>>`ë¥¼ ë°˜í™˜í•œë‹¤. ì•„ë˜ëŠ” ì²« ë²ˆì§¸ ì¸ìˆ˜ê°€ ìƒëµëœ ê²½ìš° í¸ì˜ì„± ê³¼ë¶€í•˜ë¥¼ ìœ„í•´ ì •ì˜ë˜ì–´ìˆë‹¤.

ë‚˜ëŠ” ë™ì‘ì›ë¦¬ë¥¼ ì›í•˜ë‹ˆ ì´ì œ ì§„ì§œ ì½”ë“œë¥¼ ëœ¯ì–´ë³´ì.
![repo](/posts/dev/20241015-react-useState/3.png)
ë­˜ê¹Œ..... ì´ ë¬´ì„œìš´ repoëŠ”.
`useState`ë¥¼ ì°¾ì•„ë³´ì

![type](/posts/dev/20241015-react-useState/4.png)

packages/react/src/ReactHook.js

ì°¾ì•˜ë‹¤.ã…‹ã…‹ `d.ts` íŒŒì¼ì— ìˆë˜ íƒ€ì…ì •ì˜ì™€ ë¹„ìŠ·í•œë° `js`íŒŒì¼ì—ì„œ ì–´ë–»ê²Œ í•œê±´ì§€ëŠ” ëª¨ë¥´ê² ë‹¤.

íƒ€ì…ì •ì˜ì— ë‚˜ì™€ ìˆë“¯ì´ `initialState`ë¡œ `S(state)` í˜¹ì€ `()=> S`ë¥¼ ì¸ìë¡œ ë°›ê³  `S(state)`ì™€ `Dispatch<BasicStateActrion<S>>`ë¥¼ ë°°ì—´ë¡œ ê°ì‹¸ì„œ ë°˜í™˜í•œë‹¤.

```ts
const dispatcher = resolveDispatcher();
return dispatcher.useState(initialState);
```

`dispatcher`ì•ˆì— `useState(initialState)`ê°€ `[S, Dispatch<BasicStateAction<S>>]`ë¥¼ ë°˜í™˜í•œë‹¤ëŠ” ê²ƒ ê°™ì€ë° `dispatcher`ë¥¼ ë°˜í™˜í•˜ëŠ” `resolveDispatcher` í•¨ìˆ˜ë¥¼ ì°¾ì•„ê°€ ë³´ì.

```ts
function resolveDispatcher() {
  const dispatcher = ReactSharedInternals.H;
 ...

  // Will result in a null access error if accessed outside render phase. We
  // intentionally don't throw our own error because this is in a hot path.
  // Also helps ensure this is inlined.
  return ((dispatcher: any): Dispatcher);
}
```

ê°™ì€ í´ë” ì•ˆì— ìˆì—ˆë‹¤.
`ReactSharedInternals`ë¼ëŠ” ê°ì²´ì—ì„œ `H`ë¥¼ ê°€ì ¸ì™€ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒìœ¼ë¡œ ë³´ì¸ë‹¤. `H`ëŠ” `Hook`ì¼ ê²ƒì´ë‹¤.

`ReactSharedInternals.H`ë¥¼ ë°˜í™˜í•˜ë¯€ë¡œ `ReactSharedInternals`ë¥¼ ì–´ë””ì„œ ê°€ì ¸ì˜¤ëŠ”ì§€ ë´ì•¼ê² ë‹¤.
`ReactSharedInternals`ë¥¼ ì°¾ì•„ë³´ì.

```ts
import ReactSharedInternals from "shared/ReactSharedInternals";
```

**shared** í´ë” ì•ˆì— ìˆë‹¤.

```ts
//shared/ReactSharedInternals,js
import * as React from "react";

const ReactSharedInternals =
  React.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;

export default ReactSharedInternals;
```

**??**

Reactë¥¼ ì „ì²´ ë¶ˆëŸ¬ì™€ì„œ `__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE`ë¼ëŠ” ê°’ì„ ì‚¬ìš©í•œë‹¤.

ì§ì—­í•˜ë©´ "í´ë¼ì´ì–¸íŠ¸ ë‚´ë¶€(ë“¤)ì€ ì—…ê·¸ë ˆì´ë“œ ëª»í•œë‹¤ëŠ” ê²ƒì„ ì‚¬ìš©í•˜ê±°ë‚˜ ê²½ê³ í•˜ì§€ ëª»í•œë‹¤."

- ì´ê²Œ ë§ë‚˜..? ë­” ë§ì´ì—¬

ë‹¤ì‹œ **React** ì•ˆì—ì„œ ì°¾ì•„ë³´ì.

```ts
// packages/react/index.js
export {
  __CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,
 ...
} from './src/ReactClient';
```

`ReactClient` ì•ˆì— ìˆë‹¤. ê°€ë³´ì.

```ts
//packages/react/src/ReactClient.js
import ReactSharedInternals from './ReactSharedInternalsClient';

export {
  ...
  ReactSharedInternals as __CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,
 ...
};
```

React ë‚´ì—ì„œë„ `ReactSharedInternals`ê°€ ìˆì–´ ì´ë¦„ì„ ë³€ê²½í•˜ì˜€ë‹¤. ë”°ë¼ ê°€ë³´ì

```ts
//packages/react/src/ReactSharedInternalsServer.js
const ReactSharedInternals: SharedStateClient = ({
  H: null,
  A: null,
  T: null,
  S: null,
}: any);

export default ReactSharedInternals;

```

`SharedStateClient`ëŠ” `SharedStateClient` íƒ€ì…ìœ¼ë¡œ ì •ì˜ëœë‹¤.
`SharedStateClient` íƒ€ì…ì€ ì´ë ‡ê²Œ ëœë‹¤.

```ts
export type SharedStateClient = {
  H: null | Dispatcher, // ReactCurrentDispatcher for Hooks <- Hook ê´€ë ¨ ì •ë³´ ì£¼ì…
  A: null | AsyncDispatcher,
  T: null | BatchConfigTransition,
  S: null | ((BatchConfigTransition, mixed) => void),

 ...
};
```

`H(Hook)`ì€ `Dispatcher` ë˜ëŠ” `null` íƒ€ì…ì´ë‹¤. `useState`ê°€ `null` íƒ€ì…ì¼ë¦¬ ì—†ìœ¼ë‹ˆ `Dispatcher` íƒ€ì…ì´ ë­”ì§€ ì•Œì•„ë³´ì.

`import type {Dispatcher} from 'react-reconciler/src/ReactInternalTypes';`

**react-reconciler** ì—¬ê¸°ë¡œ ê°€ë³´ì.

```ts
export type Dispatcher = {
  ...
  // useState
  useState<S>(initialState: (() => S) | S): [S, Dispatch<BasicStateAction<S>>],
  ...
   => [Awaited<S>, (P) => void, boolean],
};
```

ìƒëµì„ í–ˆì§€ë§Œ ì—„ì²­ ë§ì€ Hookë“¤ì„ ë‹´ê³  ìˆëŠ” íƒ€ì…ì´ì—ˆë‹¤.`React Hook` ë³´ëŠ” ì¤‘ ë§ì´ ë³¼ ê²ƒ ê°™ë‹¤.

ìœ„ì—ì„œ `useState`ë¥¼ í˜¸ì¶œ ì‹œ

```ts
export function useState<S>(
  initialState: (() => S) | S,
): [S, Dispatch<BasicStateAction<S>>] {
  const dispatcher = resolveDispatcher();
  return dispatcher.useState(initialState);
}

function resolveDispatcher() {
	const dispatcher = ReactSharedInternals.H;
	...
  	return ((dispatcher: any): Dispatcher);
}
```

ì—¬ê¸°ì„œ `resolveDispatcher()` í•¨ìˆ˜ëŠ” í˜„ì¬ `React`ì—ì„œ ì‚¬ìš© ì¤‘ì¸ `dispatcher`ë¥¼ ë°˜í™˜í•˜ëŠ” ì—­í• . ì´ `dispatcher`ëŠ” í˜„ì¬ ì»´í¬ë„ŒíŠ¸ì˜ í›… ê´€ë ¨ ë©”ì„œë“œë¥¼ ì œê³µí•˜ëŠ” í•µì‹¬ ê°ì²´ì´ë‹¤.
`ReactSharedInternals.H`ì—ì„œ `useState`ì— ë§ëŠ” ë™ì‘ì„ ì œê³µë°›ëŠ” ê²ƒ.

<Heading type="h4">ğŸ“šì •ë¦¬</Heading>

- `useState` í˜¸ì¶œ ì‹œ ì¼ì–´ë‚˜ëŠ” ì¼
  1.  `react`ì—ì„œ `useState`ë¥¼ importí•´ ì‚¬ìš©í•˜ë©´ `ReactHooks.js` íŒŒì¼ì—ì„œ ê°€ì ¸ì˜¨ë‹¤.
  2.  `ReactHooks.js`ì—ì„œ `useState`ëŠ” í˜¸ì¶œ ì‹œ `resolveDispatcher()` í•¨ìˆ˜ì—ì„œ `Hook`ê°ì²´ ì •ë³´ë¥¼ ì œê³µ ë°›ëŠ”ë‹¤.
  3.  `resolveDispatcher()` í•¨ìˆ˜ëŠ” **shared** í´ë”ì— `ReactSharedInternals.js` íŒŒì¼ì—ì„œ `React.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE`ë¥¼ ë°˜í™˜í•˜ëŠ”ë° ê·¸ê±´ ë‹¤ì‹œ `packages/react/src/ReactSharedInternalsClient.js` ì•ˆì—ì„œ `ReactSharedInternals`ë¼ëŠ” `H(Hook)`ë¥¼ ë‹´ê³  ìˆëŠ” ê°ì²´ì— í• ë‹¹í•œë‹¤.
- ì˜ë¬¸ì 
  - **shared**ì—ì„œ `import`í•œ `ReactSharedInternals` ê°ì²´ë¥¼ ë”°ë¼ê°€ë³´ë‹ˆ íƒ€ì…ì€ ì •ì˜ ë˜ì–´ìˆì§€ë§Œ `null`ì¸ ìƒíƒœì´ë‹¤.
  - `React` ë‚´ì— ìˆëŠ” `ReactSharedInternalsClient`ë¥¼ ì‚¬ìš©í•¨ì—ë„ ë¶ˆêµ¬í•˜ê³  **shared** í´ë”ì—ì„œ importí•˜ëŠ” ê³¼ì •ì—ì„œ `ReactSharedInternals` ê°’ì„ ë³€ê²½ì‹œì¼œ `useState` ë“± React Hookë“¤ì˜ ê°ì²´ ì •ë³´ë¥¼ ë„£ì€ ê²ƒìœ¼ë¡œ ì¶”ì¸¡ëœë‹¤.(ì˜ì¡´ì„± ì£¼ì…)

ì—¬ê¸°ê¹Œì§€ ì •ë¦¬
![ì •ë¦¬](/posts/dev/20241015-react-useState/5.png)

<Heading type="h3">ë§ˆë¬´ë¦¬</Heading>

`useState`ì˜ ë™ì‘ì›ë¦¬ë¥¼ ì•Œì•„ë³´ê¸° ìœ„í•´ ì½”ë“œë¥¼ ê¹Œë´¤ëŠ”ë° í˜¸ì¶œí•˜ë©´ ë²Œì–´ì§€ëŠ” ì¼ ì •ë„ë§Œ
ì•ˆê²ƒê°™ë‹¤. ë‹¤ìŒì—” ì§„ì§œ ë™ì‘ì›ë¦¬ì— ëŒ€í•´ ì•Œì•„ë³´ê³  ë‹¤ì‹œ ì¨ì•¼ì§€. Meta ëŒ€ë‹¨í–‰...
