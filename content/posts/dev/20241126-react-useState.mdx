---
title: "React Hook í†ºì•„ë³´ê¸° useState(2)"
tags:
  - React
  - Hook
description: "React Hook useStateì˜ ì½”ë“œë¥¼ ë³´ë©° reactì˜ ë™ì‘ì›ë¦¬ì— ëŒ€í•´ ì´í•´í•˜ì"
date: 2024.11.26
cover: "/posts/dev/20241015-react-useState/cover.png"
href: "20241015-react-useState"
series: "React Hook í†ºì•„ë³´ê¸°"
category: dev
draft: true
---

<Heading type="h2">React Hooks í†ºì•„ë³´ê¸°</Heading>

ì´ì „ì— `useState` í˜¸ì¶œ ì‹œ ì¼ì–´ë‚˜ëŠ” ë¡œì§ê¹Œì§€ ì•Œì•„ë´¤ë‹¤.
ì˜¤ëŠ˜ì€ ì •ë§ë¡œ `useState`ì˜ ë™ì‘ì›ë¦¬ì— ëŒ€í•´ ì•Œì•„ë³´ì. `*Let's get it*`

<Heading type="h3">ì´ì „ ë³µìŠµ</Heading>

1. Reactì—ì„œ useStateë¥¼ í˜¸ì¶œí•˜ë©´ `ReactHooks.js`ì—ì„œ ê°€ì ¸ì˜¨ë‹¤.
2. `ReactHooks.js` ì•ˆì— `resolveDispatcher()` í•¨ìˆ˜ì—ì„œ `Hook` ê°ì²´ ì •ë³´ê°€ ë‹´ê¸´ `dispatcher`ë¥¼ ê°€ì ¸ì˜¤ëŠ”ë° **shared** í´ë”ì—ì„œ `ReactSharedInternals`ë¼ëŠ” ê°ì²´ë¥¼ ê°€ì ¸ì™€ì„œ ì‚¬ìš©í•œë‹¤.
3. ì´ë•Œ `ReactSharedInternals`ëŠ” **react-reconciler**ë¼ëŠ” ê³³ì—ì„œ `dispatcher` íƒ€ì…ì„ ì°¸ì¡°í•˜ê³  ê°’ì€ **React**ì—ì„œ `ReactSharedInternalsClient`ì—ì„œ ê°’ì„ ê°€ì ¸ì˜¨ë‹¤.
4. ì—¬ê¸°ì„œ `ReactSharedInternals.H`ì€ ë¶„ëª… `null`ê°’ì´ì—ˆëŠ”ë° `resolveDispatcher()`ì—ì„  dispatcherë¥¼ ë°˜í™˜í•˜ê¸°ì— `Hook`ë“¤ì„ ì‚¬ìš©í• ìˆ˜ ìˆë‹¤. ê°ì²´ê°’ì´ ë°”ë€ ì´ìœ ê°€ ìˆì„ê²ƒì´ê³  ì˜¤ëŠ˜ì€ ê·¸ ì›ì¸ì„ ì°¾ì„ ê²ƒì´ë‹¤.

<Heading type="h3">ğŸ¤— ë³µê¸°</Heading>

ë¶„ëª… ì–´ë”˜ê°€ì—ì„œ `ReactSharedInternals.H`ë¥¼ ê±´ë“œë¦° ê²ƒì´ ë¶„ëª…í•˜ë‹ˆ ì°¾ì•„ë³´ì.

![search](/posts/dev/20241126-react-useState/1.png)

ì‹¬ìƒì¹˜ ì•Šì€ ë…€ì„ì´ ìˆë‹¤. ì´ë…€ì„ì´ `null`ì— `dispatcher`ë¥¼ ì£¼ì…í•œ ë…€ì„ì¼ ê²ƒì´ë‹¤.
`ReactFiberHooks.js`ë¡œ ê°€ë³´ì.

**packages/react-reconciler/src/ReactFiberHook.js**

ê·¸ì „ì— ì ê¹ **Fiber**ê°€ ë­˜ê¹Œ??

<Heading type="h3">Fiber</Heading>

í”¼ë²„ë¼ê³  ë¶€ë¥´ëŠ” ì¤„ ì•Œì•˜ëŠ”ë° **íŒŒì´ë²„**ë¼ê³  ì½ë‚˜ë³´ë‹¤.(í™”ì´ë°”..?)
FiberëŠ” React Ver16 ë²„ì „ë¶€í„° ë„ì…ëœ Reactì— ì‘ì—…ì„ ë¶„ë¥˜í•˜ì—¬ ìš°ì„ ìˆœìœ„ë¥¼ ì •í•˜ê³  **ë” ë†’ì€ ìš°ì„ ìˆœìœ„ë¥¼ ê°€ì§„ ì‘ì—…ì´ ìš”ì²­ë  ê²½ìš° ê¸°ì¡´ ì‘ì—…ì„ ì¼ì‹œì •ì§€** í›„ ìš°ì„ ëœ ì‘ì—…ì´ ì¢…ë£Œëœ í›„ì—ëŠ” **ê¸°ì¡´ ì‘ì—…ìœ¼ë¡œ ëŒì•„ê°€ê±°ë‚˜ ì™„ì „íˆ ì¤‘ë‹¨**ì‹œí‚¤ëŠ” **ì¬ì¡°ì •ì(reconciler) ì•„í‚¤í…ì³**ë‹¤. ë³´í†µ Reactì˜ VDOMì—ì„œ ì´ì „ ìƒíƒœê°’ê³¼ í˜„ì¬ ìƒíƒœê°’ì„ ì €ì¥í•˜ê³  ìˆëŠ” ë…¸ë“œë¼ê³  ìƒê°í•˜ë©´ëœë‹¤.

ì˜ë¯¸ë¡œë§Œ ë³¸ë‹¤ë©´ useStateê°€ í˜¸ì¶œë˜ë©´ `ReactSharedInternals`ë¥¼ ê°€ì ¸ì˜¬ ë•Œ ì¤‘ê°„ì— ê°’ì„ ë³€ê²½ì‹œí‚¤ëŠ” ì—­í• ë„ í•˜ì§€ ì•Šì•˜ì„ê¹Œ ì˜ˆìƒí•´ë³¸ë‹¤. ì•„ë‹˜ë§ê³ . ì¼ë‹¨ ê°€ë³´ì.

<Heading type="h3">ReactFiberHook.js</Heading>

```ts
...
// ì—­ì‹œ shared/ReactSharedInternalsì—ì„œ ê°€ì ¸ì™”ë‹¤.
import ReactSharedInternals from 'shared/ReactSharedInternals';
...
// react ì‘ì—…ì— ë”°ë¼ Dispatcherë¥¼ ë‹´ëŠ” ê°ì²´ë“¤ì´ ìˆë‹¤.
let HooksDispatcherOnMountInDEV: Dispatcher | null = null;
let HooksDispatcherOnMountWithHookTypesInDEV: Dispatcher | null = null;
let HooksDispatcherOnUpdateInDEV: Dispatcher | null = null;
let HooksDispatcherOnRerenderInDEV: Dispatcher | null = null;
let InvalidNestedHooksDispatcherOnMountInDEV: Dispatcher | null = null;
let InvalidNestedHooksDispatcherOnUpdateInDEV: Dispatcher | null = null;
let InvalidNestedHooksDispatcherOnRerenderInDEV: Dispatcher | null = null;

...

ReactSharedInternals.H = HooksDispatcherOnUpdateInDEV;
...
ReactSharedInternals.H = HooksDispatcherOnMountWithHookTypesInDEV;
...
ReactSharedInternals.H =
      current === null || current.memoizedState === null
        ? HooksDispatcherOnMount
        : HooksDispatcherOnUpdate;
...
```

**ReactFiberHook.js**ì—ì„œ `ReactSharedInternals.H` ìƒí™©ì— ë”°ë¼ ë‹¤ì–‘í•˜ê²Œ `Hook`ê°’ì„ ë³€ê²½í•˜ê³  ìˆë‹¤.

ê·¸ ì¤‘ ì°¾ì•˜ë‹¤.

```ts
// ë§ˆìš´íŠ¸ ë  ë•Œ ë“¤ì–´ê°ˆ Hooks Dispatcher ê°’
const HooksDispatcherOnMount: Dispatcher = {
  readContext,

  use,
  useCallback: mountCallback,
  useContext: readContext,
  useEffect: mountEffect,
  useImperativeHandle: mountImperativeHandle,
  useLayoutEffect: mountLayoutEffect,
  useInsertionEffect: mountInsertionEffect,
  useMemo: mountMemo,
  useReducer: mountReducer,
  useRef: mountRef,
  useState: mountState,
  useDebugValue: mountDebugValue,
  useDeferredValue: mountDeferredValue,
  useTransition: mountTransition,
  useSyncExternalStore: mountSyncExternalStore,
  useId: mountId,
};
// ì—…ë°ì´íŠ¸ ë  ë•Œ ë“¤ì–´ê°ˆ Hooks Dispatcher ê°’
const HooksDispatcherOnUpdate: Dispatcher = {
  readContext,

  use,
  useCallback: updateCallback,
  useContext: readContext,
  useEffect: updateEffect,
  useImperativeHandle: updateImperativeHandle,
  useInsertionEffect: updateInsertionEffect,
  useLayoutEffect: updateLayoutEffect,
  useMemo: updateMemo,
  useReducer: updateReducer,
  useRef: updateRef,
  useState: updateState,
  useDebugValue: updateDebugValue,
  useDeferredValue: updateDeferredValue,
  useTransition: updateTransition,
  useSyncExternalStore: updateSyncExternalStore,
  useId: updateId,
};
```

ìš°ë¦¬ê°€ ë³¼ê²ƒì€ `HooksDispatcherOnMount` ë§ˆìš´íŠ¸ ë  ë•Œ Hookì´ ë‹´ê¸°ëŠ” ë¶€ë¶„ì„ ë³´ë©´ ëœë‹¤.

ìˆ˜ë§ì€ í•¨ìˆ˜ ì¤‘ `ReactSharedInternals.H = HooksDispatcherOnMount` ë¥¼ ì‚¬ìš©í•˜ëŠ” í•¨ìˆ˜ëŠ” ë‘ê°œ

`renderWithHooks`ì™€ `useThenable` í•¨ìˆ˜
`useThenable`í•¨ìˆ˜ì˜ ê²½ìš°ëŠ” **ReactFiberHook.js**ë‚´ì—ì„œ Fiberì˜ ë™ì‘ ë¡œì§ ì¤‘ í•˜ë‚˜ë¡œ ë³´ì¸ë‹¤.

`renderWithHooks()`ë¥¼ ì‚´í´ë³´ì

<Heading type="h4">renderWithHooks()</Heading>

```ts
//renderWithHooks()
export function renderWithHooks<Props, SecondArg>(
  current: Fiber | null, // ì—…ë°ì´íŠ¸ ì „
  workInProgress: Fiber, // ì—…ë°ì´íŠ¸ë¥¼ í•˜ê¸° ìœ„í•œ hook
  Component: (p: Props, arg: SecondArg) => any,
  props: Props,
  secondArg: SecondArg,
  nextRenderLanes: Lanes,
): any {
  renderLanes = nextRenderLanes;
  currentlyRenderingFiber = workInProgress;

  if (__DEV__) {
    hookTypesDev =
      current !== null
        ? ((current._debugHookTypes: any): Array<HookType>)
        : null;
    hookTypesUpdateIndexDev = -1;
    // Used for hot reloading:
    ignorePreviousDependencies =
      current !== null && current.type !== workInProgress.type;

    warnIfAsyncClientComponent(Component);
  }

  workInProgress.memoizedState = null;
  workInProgress.updateQueue = null;
  workInProgress.lanes = NoLanes;

  ...

  if (__DEV__) {
    // ê°œë°œ ë¡œì§.
    if (current !== null && current.memoizedState !== null) {
      ReactSharedInternals.H = HooksDispatcherOnUpdateInDEV;
    } else if (hookTypesDev !== null) {
      ...
      ReactSharedInternals.H = HooksDispatcherOnMountWithHookTypesInDEV;
    } else {
      ReactSharedInternals.H = HooksDispatcherOnMountInDEV;
    }
  } else {
    ReactSharedInternals.H =
      current === null || current.memoizedState === null
        ? HooksDispatcherOnMount
        : HooksDispatcherOnUpdate;
  }

  ...
  // ê°œë°œ í™˜ê²½ì—ì„œ ë‘ë²ˆ ë¦¬ë Œë”ë§ì´ í•„ìš”í•œì§€ í™•ì¸
  const shouldDoubleRenderDEV =
    __DEV__ &&
    debugRenderPhaseSideEffectsForStrictMode &&
    (workInProgress.mode & StrictLegacyMode) !== NoMode;

  shouldDoubleInvokeUserFnsInHooksDEV = shouldDoubleRenderDEV;
  let children = __DEV__
    ? callComponentInDEV(Component, props, secondArg)
    : Component(props, secondArg);
  shouldDoubleInvokeUserFnsInHooksDEV = false;

  /**
	 ë Œë” íŒ¨ìŠ¤ ì¤‘ì—ë§Œ ì—…ë°ì´íŠ¸ê°€ ì˜ˆì•½ëœ ê²½ìš° ì‹œë„í•  ë•Œ ë§ˆë‹¤ ì¬ì„¤ì •ë˜ëŠ”
	ê°’ìœ¼ë¡œ didScheduleRenderPhaseUpdate ë‚˜ numberOfReRendersì„ ì´ìš©í•´
	í†µí•©í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ìˆì–´ë³´ì¸ë‹¤. ë¼ëŠ” ê²ƒì„ ë¯¸ë£¨ì–´ë³¼ ë•Œ êµ³ì´ ì‹ ê²½ì“¸ í•„ìš”ëŠ” ì—†ëŠ”
	ì¹œêµ¬ë¡œ ë³´ì¸ë‹¤.
  */
  if (didScheduleRenderPhaseUpdateDuringThisPass) {
    // ì•„ë˜ í•¨ìˆ˜ë„ ê³µë¶€í•  ë¡œì§ì— ë‹¹ì¥ ì˜í–¥ì„ ì£¼ì§„ ì•ŠëŠ”ë‹¤
    children = renderWithHooksAgain(
      workInProgress,
      Component,
      props,
      secondArg,
    );
  }

  if (shouldDoubleRenderDEV) {
    // In development, components are invoked twice to help detect side effects.
    setIsStrictModeForDevtools(true);
    try {
      children = renderWithHooksAgain(
        workInProgress,
        Component,
        props,
        secondArg,
      );
    } finally {
      setIsStrictModeForDevtools(false);
    }
  }
  // ëª¨ë“  hook ê³„ì‚° ë¡œì§ë“¤ì„ ìˆ˜í–‰í•œ ì´í›„ ê¸°ì¡´ì— ì‚¬ìš©í•˜ë˜ ê°ì²´ë“¤ì„ ë¹„ìš°ëŠ” ì‘ì—…ì„
  // ìˆ˜í–‰í•œë‹¤. ì´ê²ƒë„ í¬ê²Œ ì‹ ê²½ ì“¸ í•„ìš”ëŠ” ì—†ë‹¤.
  finishRenderingHooks(current, workInProgress, Component);

  return children;
}

```

ìƒˆë¡œìš´ hookì •ë³´ê°€ ë‹´ê¸´ `workInProgress`ê°€ `currentlyRenderingFiber`ì— ë‹´ê¸°ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.

```js
currentlyRenderingFiber = workInProgress;
```

`currentlyRenderingFiber`ê°€ ë¬´ì—‡ì¸ê°€ ë³´ë©´

<Heading type="h4">currentlyRenderingFiber</Heading>

```js
// The work-in-progress fiber. I've named it differently to distinguish it from
// the work-in-progress hook.
let currentlyRenderingFiber: Fiber = (null: any);
```

`currentlyRenderingFiber`ëŠ” `Fiber` íƒ€ì…ì˜ ê°ì²´ì´ë‹¤.

`React Reconciler` ë‚´ì— ì „ì—­ë³€ìˆ˜ë¡œì„œ ì„ ì–¸ë˜ì–´ ìˆë‹¤.
ê°œë°œì ì£¼ì„ì—ëŠ” ì§„í–‰ì¤‘ì¸ hookê³¼ ì´ë¦„ì„ ì¼ë¶€ëŸ¬ ë‹¤ë¥´ê²Œ ì§€ì—ˆë‹¤ê³  ì„¤ëª…í•˜ê³  ìˆë‹¤.

ê·¸ëŸ¼ `currentlyRenderingFiber`ì— ì–´ë–¤ ê°’ì„ ì €ì¥ì„ í•˜ë‚˜?

`Fiber` íƒ€ì…ì„ ì‚´í´ë³´ë©´

```ts
export type Fiber = {

  ...

  // The state used to create the output
  memoizedState: any,

  ...

};
```

ì´ `Fiber`ëŠ” í˜„ì¬ì˜ hookê³¼ ë¹„êµë˜ëŠ” ì €ì¥ëœ `Fiber` ê°ì²´ë¡œ í˜„ì¬ `React` ê°™ì€ ìƒíƒœê´€ë¦¬ Hookì˜ stateê°€ ì €ì¥ë˜ëŠ” ê³³ì´ë‹¤.

ê³„ì† ë³´ì

```js
// ë§¤ê°œë³€ìˆ˜ ê°ì²´ë¥¼ ì§ì ‘ ìˆ˜ì •í•˜ëŠ” ì¼€ì´ìŠ¤
workInProgress.memoizedState = null;
workInProgress.updateQueue = null;
```

í•´ë‹¹ í•¨ìˆ˜ì—ì„œ ë§¤ê°œë³€ìˆ˜ì¸ `workInProgress` ê°ì²´ëŠ” ì°¸ì¡°í˜• ìë£Œ íƒ€ì…ì´ê¸° ë•Œë¬¸ì— ì•ˆì— ìˆëŠ” ê°’ì„ ì§ì ‘ ìˆ˜ì •í•  ìˆ˜ ìˆë‹¤.

```ts
ReactSharedInternals.H =
  current === null || current.memoizedState === null
    ? HooksDispatcherOnMount
    : HooksDispatcherOnUpdate;
```

`ReactSharedInternals`ì˜ `H(Hook)`ì€ `Dispatcher` íƒ€ì…ì„ ì°¸ì¡°í•˜ê³  ìˆë‹¤.
ê·¸ë¦¬ê³  `current`ëŠ” ë§¤ê°œë³€ìˆ˜ë¡œ `Fiber` íƒ€ì…ì´ë‹¤.
ê·¸ëŸ¬ë‹ˆ `current === null || current.memoizedState === null` ì´ ë‘ ì¡°ê±´ì´ **mount**ë˜ëŠ” ì¡°ê±´ìœ¼ë¡œ
`HooksDispatcherOnMount`ë¥¼ ë„˜ê²¨ì£¼ê³  mount ì¡°ê±´ì´ ì•„ë‹ˆë©´ updateì— ëŒ€í•œ dispatcher(HooksDispatcherOnUpdate)ë¥¼ ë„˜ê²¨ì£¼ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.

<Heading type="h4">HooksDispatcherOnMount</Heading>

`HooksDispatcherOnMount`ì˜ íƒ€ì…ì„ ë³´ë©´

```ts
const HooksDispatcherOnMount: Dispatcher = {
  readContext,

  use,
  useCallback: mountCallback,
  useContext: readContext,
  useEffect: mountEffect,
  useImperativeHandle: mountImperativeHandle,
  useLayoutEffect: mountLayoutEffect,
  useInsertionEffect: mountInsertionEffect,
  useMemo: mountMemo,
  useReducer: mountReducer,
  useRef: mountRef,
  useState: mountState,
  useDebugValue: mountDebugValue,
  useDeferredValue: mountDeferredValue,
  useTransition: mountTransition,
  useSyncExternalStore: mountSyncExternalStore,
  useId: mountId,
};
```

ì´ë ‡ê²Œ `Hook`ë“¤ì´ ê°ì²´ì— ë‹´ê²¨ ìˆê³  ìš°ë¦¬ëŠ” ì˜¤ëŠ˜ `useState`ë§Œ ë³¼ê±°ë‹¤.
`useState`ì—ëŠ” `mountState`ë¼ëŠ” ê²Œ ë‹´ê²¨ ìˆë‹¤. `HooksDispatcherOnUpdate`ì—ëŠ” `useState`ì— `updateState`ë¼ëŠ” ê²Œ ë‹´ê²¨ìˆë‹¤.
ë¨¼ì € `mountState`ì— ê°€ë³´ì.

<Heading type="h4">mountState</Heading>

```ts
function mountState<S>(
  initialState: (() => S) | S,
): [S, Dispatch<BasicStateAction<S>>] {
  const hook = mountStateImpl(initialState);
  const queue = hook.queue;
  const dispatch: Dispatch<BasicStateAction<S>> = (dispatchSetState.bind(
    null,
    currentlyRenderingFiber,
    queue,
  ): any);
  queue.dispatch = dispatch;
  return [hook.memoizedState, dispatch];
}
```

`mountState`ëŠ” í•¨ìˆ˜ì˜€ë‹¤. ê·¸ë¦¬ê³  ìš°ë¦¬ê°€ ì•„ëŠ” `useState`ê°€ í•¨ìˆ˜ë¼ë©´ ì´ë ‡ê²Œ ìƒê²¼ê² ë‹¤ ì‹¶ì€ í•¨ìˆ˜ë‹¤.
ì½”ë“œë¥¼ ë¶„ì„í•´ ë³´ì.

```ts
const hook = mountStateImpl(initialState);
```

ìš°ë¦¬ëŠ” `useState`ë¥¼ ì‚¬ìš©í•  ë•Œ `initialState`ê°’ì„ ë„£ì–´ì¤€ë‹¤.
ê·¸ ê°’ì„ ë§¤ê°œ ë³€ìˆ˜ë¡œ ë°›ì•„ì„œ `mountStateImpl`í•¨ìˆ˜ì— ë„£ì–´ì£¼ëŠ”ë° ì™œ ë„£ì–´ì£¼ëŠ” ì§€ ë˜ ì½”ë“œë¡œ ê°€ë´ì•¼í•œë‹¤.

<Heading type="h4">mountStateImpl</Heading>

`Impl`ì´ ë¬´ì—‡ì¼ê¹Œ?
ë””ìì¸ íŒ¨í„´ ì¤‘ í•˜ë‚˜ë¡œ ì–´ëŒ‘í„° íŒ¨í„´ì´ë¼ê³  ë¶€ë¥´ë©°
êµ¬í˜„ì²´ëŠ” ìµœëŒ€í•œ `Impl`ì— ëª°ì•„ë„£ê³  ì‹¤ì œë¡œ ì‚¬ìš©í•  ë¡œì§ê³¼ ë¶„ë¦¬í•˜ëŠ” ê²ƒì„ ë§í•œë‹¤.

```ts
function mountStateImpl<S>(initialState: (() => S) | S): Hook {
  const hook = mountWorkInProgressHook();
  if (typeof initialState === 'function') {
    const initialStateInitializer = initialState;
    // $FlowFixMe[incompatible-use]: Flow doesn't like mixed types
    initialState = initialStateInitializer();
    if (shouldDoubleInvokeUserFnsInHooksDEV) {
      setIsStrictModeForDevtools(true);
      // $FlowFixMe[incompatible-use]: Flow doesn't like mixed types
      initialStateInitializer();
      setIsStrictModeForDevtools(false);
    }
  }
```

ì—¬ê¸°ì„œë„ hookì„ `mountWorkInProgressHook`ì—ì„œ ë°˜í™˜ëœ ê°’ì„ ê°€ì ¸ì˜¨ë‹¤.

<Heading type="h4">mountWorkInProgressHook</Heading>

```ts
function mountWorkInProgressHook(): Hook {
  const hook: Hook = {
    memoizedState: null,

    baseState: null,
    baseQueue: null,
    queue: null,

    next: null,
  };

  if (workInProgressHook === null) {
    // This is the first hook in the list
    currentlyRenderingFiber.memoizedState = workInProgressHook = hook;
  } else {
    // Append to the end of the list
    workInProgressHook = workInProgressHook.next = hook;
  }
  return workInProgressHook;
}
```

ì½”ë“œë¥¼ ë³´ë©´ hookì´ë€ ê°ì²´ë¥¼ ì´ˆê¸°í™” í•´ì£¼ê³  `workInProgressHook` ê°’ì´ `null`ì´ë¼ë©´ ìœ„ì—ì„œ ì–¸ê¸‰í•œ `currentlyRenderingFiber`ì˜ `memoizedState`ê°’ê³¼ `workInProgressHook`ì— ì´ˆê¸°í™”ëœ `hook` ê°ì²´ë¥¼ ë„£ì–´ì¤€ë‹¤.
ì•„ë‹ˆë¼ë©´ `workInProgressHook`ê³¼ `workInProgressHook.next`ì— `hook`ì„ ë„£ì–´ì£¼ëŠ” ë¡œì§ì´ë¼ê³  ë³´ì¸ë‹¤.

`hook` ê°ì²´ëŠ” `Hook` íƒ€ì…ì´ ëª…ì‹œë˜ì–´ ìˆëŠ”ë°

```ts
export type Hook = {
  memoizedState: any;
  baseState: any;
  baseQueue: Update<any, any> | null;
  queue: any;
  next: Hook | null;
};
```

`memoizedState`ëŠ” ìœ„ `mountState`ì—ì„œ ë°˜í™˜í•˜ëŠ” ì²«ë²ˆì§¸ ê°’. `hook.memoizedState`.

`useStaet`ë¡œ ì˜ˆë¥¼ ë“¤ë©´

```ts
const [state, setState] = useStaet(0);
```

ì—ì„œ ë Œë”ë§ ì‹œ ë…¸ì¶œë˜ëŠ” ê°’ `state`ì´ë‹¤.

ê·¸ë¦¬ê³  baseStateëŠ” `mountState`ì—ì„œ ë°˜í™˜í•˜ëŠ” ë‘ë²ˆì§¸ ê°’ `dispatch` ê·¸ íƒ€ì…ì€ `Dispatch<BasicStateAction<S>>`ë¥¼ ëª…ì‹œí•˜ê³  ìˆë‹¤.
ì‰½ê²Œ ë§í•´ ê¸°ë³¸ ê°’ì´ë¼ëŠ” ê±´ë°
`useStae`ì˜ `setState`ëŠ” ì½œë°±í•¨ìˆ˜ë¥¼ ì¸ìë¡œ ë°›ì„ ìˆ˜ ìˆë‹¤.

```ts
setState((prev) => prev);
```

ì—¬ê¸°ì„œ `prev`ê°€ `baseState`ë¼ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.

<Heading type="h3">ğŸ“š ë§ˆë¬´ë¦¬</Heading>

![graph](/posts/dev/20241126-react-useState/2.png)

ìƒê°ë³´ë‹¤ `useState` ë¶„ì„ì´ ê¸¸ì–´ì§€ê³  ìˆë‹¤. ìì£¼ ì“°ëŠ” `Hook`ì´ë¼ê³  ë§ì´ ì–•ë´¤ë˜ ê²ƒ
ê°™ë‹¤. ê·¸ë˜ë„ ì½”ë“œë¥¼ ë³´ë©° `useState`ì˜ ë™ì‘ ì›ë¦¬ì— ëŒ€í•´ ì´í•´ê°€ ë˜ê³  ìˆìœ¼ë‹ˆ ì¬ë°Œë‹¤ëŠ” ìƒê°ì´ ë“ ë‹¤.
ì–¸ë¥¸ ë¶„ì„ì„ ëë‚´ê³  ë‹¤ìŒ `Hook`ë„ ì•Œì•„ë³´ê³  ì‹¶ì–´ì¡Œë‹¤.
